<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的音乐</title>
    <style>
        /* 基础样式，确保界面简洁易用 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Arial", sans-serif;
        }

        body {
            background: #f5f7fa;
            padding: 40px 20px;
        }

        .music-player {
            max-width: 500px;
            margin: 0 auto;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* 播放器头部 */
        .player-header {
            background: #2d3436;
            color: #fff;
            padding: 20px;
            text-align: center;
            font-size: 20px;
            font-weight: 600;
        }

        /* 当前播放歌曲信息 */
        .current-song {
            padding: 25px;
            text-align: center;
            border-bottom: 1px solid #f1f1f1;
        }

        .current-song__title {
            font-size: 18px;
            color: #2d3436;
            margin-bottom: 8px;
        }

        .current-song__mode {
            font-size: 14px;
            color: #636e72;
            background: #f1f1f1;
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
        }

        /* 播放控制按钮区域 */
        .control-buttons {
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
            border-bottom: 1px solid #f1f1f1;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: #2d3436;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .control-btn:hover {
            background: #0984e3;
        }

        .control-btn--play {
            width: 65px;
            height: 65px;
            font-size: 20px;
        }

        /* 播放列表区域 */
        .playlist {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px 0;
        }

        .playlist__item {
            padding: 12px 25px;
            font-size: 16px;
            color: #2d3436;
            cursor: pointer;
            transition: background 0.2s;
        }

        .playlist__item:hover {
            background: #f1f1f1;
        }

        .playlist__item--active {
            background: #e3f2fd;
            color: #0984e3;
            font-weight: 500;
        }

        /* 滚动条美化 */
        .playlist::-webkit-scrollbar {
            width: 6px;
        }

        .playlist::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="music-player">
        <!-- 播放器头部 -->
        <div class="player-header">纯 JS 音乐播放器</div>

        <!-- 当前播放歌曲信息 -->
        <div class="current-song">
            <div class="current-song__title" id="currentSongTitle">未播放歌曲</div>
            <div class="current-song__mode" id="playModeText">播放模式：顺序播放</div>
        </div>

        <!-- 播放控制按钮 -->
        <div class="control-buttons">
            <button class="control-btn" id="prevBtn">上一曲</button>
            <button class="control-btn control-btn--play" id="playPauseBtn">播放</button>
            <button class="control-btn" id="nextBtn">下一曲</button>
            <button class="control-btn" id="modeBtn">切换模式</button>
        </div>

        <!-- 播放列表 -->
        <div class="playlist" id="playlistContainer"></div>
    </div>

    <script>
        // 1. 配置音频数据源（替换为你的音频 URL 数组，可自定义歌曲名称）
        let audioList = [
            { title: "歌曲 1 - 示例", url: "https://example.com/audio1.mp3" },
            { title: "歌曲 2 - 示例", url: "https://example.com/audio2.mp3" },
            { title: "歌曲 3 - 示例", url: "https://example.com/audio3.mp3" },
            { title: "歌曲 4 - 示例", url: "https://example.com/audio4.mp3" },
            { title: "歌曲 5 - 示例", url: "https://example.com/audio5.mp3" }
        ];

        // 2. 初始化核心变量
        const audio = new Audio(); // 创建音频实例
        let currentIndex = 0; // 当前播放歌曲索引
        let playMode = 0; // 播放模式：0=顺序播放，1=列表循环，2=随机播放
        const modeTextMap = ["顺序播放", "列表循环", "随机播放"]; // 模式文本映射

        // 3. 获取 DOM 元素
        const playPauseBtn = document.getElementById("playPauseBtn");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const modeBtn = document.getElementById("modeBtn");
        const currentSongTitle = document.getElementById("currentSongTitle");
        const playModeText = document.getElementById("playModeText");
        const playlistContainer = document.getElementById("playlistContainer");
        
        function getAudioList() {
            return fetch('./audio/index.json')
        .then(response => {
            if (!response.ok) {
                throw new Error(`请求失败，状态码: ${response.status}`);
            }
            return response.json();
        })
        .then(res => {
            console.log('res', res)

            return res.files.map(name => {
                return {
                    title: name,
                    url: `./audio/list/${name}`
                }
            })
        });
        }
        // 4. 初始化播放列表
         function initPlaylist() {
            playlistContainer.innerHTML = ""; // 清空列表
            getAudioList().then((list) => {
                audioList = list;
                audioList.forEach((song, index) => {
                const item = document.createElement("div");
                item.className = `playlist__item ${index === currentIndex ? "playlist__item--active" : ""}`;
                item.textContent = `${index + 1}. ${song.title || song}`;
                // 点击列表项播放对应歌曲
                item.addEventListener("click", () => {
                    currentIndex = index;
                    loadAndPlayCurrentSong();
                    updatePlaylistActiveStatus();
                });
                playlistContainer.appendChild(item);
            });
        
            })
            }

        // 5. 加载并播放当前索引的歌曲
        function loadAndPlayCurrentSong() {
            const currentSong = audioList[currentIndex];
            audio.src = currentSong.url; // 设置音频源
            currentSongTitle.textContent = currentSong.title; // 更新歌曲标题
            audio.play().then(() => {
                playPauseBtn.textContent = "暂停"; // 切换按钮文本
            }).catch(err => {
                console.error("播放失败：", err);
                alert("音频加载失败，请检查 URL 是否有效");
            });
        }

        // 6. 更新播放列表激活状态（高亮当前播放歌曲）
        function updatePlaylistActiveStatus() {
            const allItems = document.querySelectorAll(".playlist__item");
            allItems.forEach((item, index) => {
                item.classList.toggle("playlist__item--active", index === currentIndex);
            });
        }

        // 7. 切换播放/暂停状态
        playPauseBtn.addEventListener("click", () => {
            if (audio.paused) {
                // 若未加载音频，先加载当前歌曲
                if (!audio.src) {
                    loadAndPlayCurrentSong();
                } else {
                    audio.play();
                    playPauseBtn.textContent = "暂停";
                }
            } else {
                audio.pause();
                playPauseBtn.textContent = "播放";
            }
        });

        // 8. 上一曲逻辑
        prevBtn.addEventListener("click", () => {
            switch (playMode) {
                case 0: // 顺序播放：第一首的上一曲还是第一首
                    currentIndex = currentIndex === 0 ? 0 : currentIndex - 1;
                    break;
                case 1: // 列表循环：第一首的上一曲是最后一首
                    currentIndex = currentIndex === 0 ? audioList.length - 1 : currentIndex - 1;
                    break;
                case 2: // 随机播放：随机生成索引（排除当前索引）
                    let randomIndex;
                    do {
                        randomIndex = Math.floor(Math.random() * audioList.length);
                    } while (randomIndex === currentIndex && audioList.length > 1);
                    currentIndex = randomIndex;
                    break;
            }
            loadAndPlayCurrentSong();
            updatePlaylistActiveStatus();
        });

        // 9. 下一曲逻辑（音频结束时自动触发）
        function handleNextSong() {
            switch (playMode) {
                case 0: // 顺序播放：最后一首结束后暂停
                    currentIndex = currentIndex === audioList.length - 1 ? audioList.length - 1 : currentIndex + 1;
                    if (currentIndex === audioList.length - 1) {
                        loadAndPlayCurrentSong();
                        // 播放完最后一首后自动暂停
                        audio.addEventListener("ended", () => {
                            audio.pause();
                            playPauseBtn.textContent = "播放";
                        }, { once: true });
                    } else {
                        loadAndPlayCurrentSong();
                    }
                    break;
                case 1: // 列表循环：最后一首的下一曲是第一首
                    currentIndex = currentIndex === audioList.length - 1 ? 0 : currentIndex + 1;
                    loadAndPlayCurrentSong();
                    break;
                case 2: // 随机播放：随机生成索引（排除当前索引）
                    let randomIndex;
                    do {
                        randomIndex = Math.floor(Math.random() * audioList.length);
                    } while (randomIndex === currentIndex && audioList.length > 1);
                    currentIndex = randomIndex;
                    loadAndPlayCurrentSong();
                    break;
            }
            updatePlaylistActiveStatus();
        }

        // 下一曲按钮点击事件
        nextBtn.addEventListener("click", handleNextSong);
        // 音频播放结束时自动下一曲
        audio.addEventListener("ended", handleNextSong);

        // 10. 切换播放模式
        modeBtn.addEventListener("click", () => {
            playMode = (playMode + 1) % 3; // 循环切换 0→1→2→0
            playModeText.textContent = `播放模式：${modeTextMap[playMode]}`;
        });

        // 11. 初始化播放器（页面加载完成后执行）
        window.addEventListener("load", () => {
            initPlaylist();
            playModeText.textContent = `播放模式：${modeTextMap[playMode]}`;
        });
    </script>
</body>
</html>